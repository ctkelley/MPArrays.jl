<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Half Precision · MultiPrecisionArrays.jl</title><meta name="title" content="Half Precision · MultiPrecisionArrays.jl"/><meta property="og:title" content="Half Precision · MultiPrecisionArrays.jl"/><meta property="twitter:title" content="Half Precision · MultiPrecisionArrays.jl"/><meta name="description" content="Documentation for MultiPrecisionArrays.jl."/><meta property="og:description" content="Documentation for MultiPrecisionArrays.jl."/><meta property="twitter:description" content="Documentation for MultiPrecisionArrays.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MultiPrecisionArrays.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">More than you want to know</span><ul><li><a class="tocitem" href="../Interprecision_1/">Interprecision Transfers: Part I</a></li><li class="is-active"><a class="tocitem" href>Half Precision</a></li></ul></li><li><span class="tocitem">MPArray Constructors</span><ul><li><a class="tocitem" href="../../functions/MPArray/">MPArray: constructor</a></li></ul></li><li><span class="tocitem">Factorizations</span><ul><li><a class="tocitem" href="../../functions/hlu!/">hlu!: Get LU to perform reasonably well for Float16</a></li><li><a class="tocitem" href="../../functions/mplu!/">mplu!: Simple MPArray factorization</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../../functions/mpgeslir/">mpgeslir: IR solver</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">More than you want to know</a></li><li class="is-active"><a href>Half Precision</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Half Precision</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ctkelley/MultiPrecisionArrays.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ctkelley/MultiPrecisionArrays.jl/blob/main/docs/src/Details/Half_1.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Half-Precision"><a class="docs-heading-anchor" href="#Half-Precision">Half Precision</a><a id="Half-Precision-1"></a><a class="docs-heading-anchor-permalink" href="#Half-Precision" title="Permalink"></a></h1><p>Using half precision will not speed anything up, in fact it will make  the solver slower. The reason for this is that LAPACK and the BLAS  do not (<strong>YET</strong>) support half precision, so all the clever stuff in there is missing. We provide a half precision LU factorization <strong>/src/Factorizations/hlu!.jl</strong> that is better than nothing.  It&#39;s a hack of Julia&#39;s  <code>generic_lu!</code> with threading and a couple compiler directives. Even so, it&#39;s 2.5 – 5 x <strong>slower</strong> than a  double precision LU. Half precision support is coming  (Julia and Apple support it in hardware!) but for now, at least for desktop computing, half precision is for research in iterative refinement, not applications. </p><p>Here&#39;s a table (created with  <strong>/Code<em>For</em>Docs/HalfTime.jl</strong> ) that illustrates the point. In the table we compare timings for LAPACK&#39;s LU to the LU we compute with <code>hlu!.jl</code>. The matrix is  <span>$I-800.0*G$</span>.</p><pre><code class="nohighlight hljs">      N       F64       F32       F16     F16/F64 
     1024  3.65e-03  2.65e-03  5.26e-03  1.44e+00 
     2048  2.26e-02  1.41e-02  3.70e-02  1.64e+00 
     4096  1.55e-01  8.53e-02  2.55e-01  1.65e+00 
     8192  1.15e+00  6.05e-01  4.23e+00  3.69e+00 </code></pre><p>The columns of the table are the dimension of the problem, timings for double, single, and half precision, and the ratio of the half precision timings to double. The timings came from Julia 1.10-beta2 running on an Apple M2 Pro with 8 performance cores.</p><p>Half precision is also difficult to use properly. The low precision can  make iterative refinement fail because the half precision factorization  can have a large error. Here is an example to illustrate this point.  The matrix here is modestly ill-conditioned and you can see that in the  error from a direct solve in double precision.</p><pre><code class="nohighlight hljs">julia&gt; A=I - 800.0*G;

julia&gt; x=ones(N);

julia&gt; b=A*x;

julia&gt; xd=A\b;

julia&gt; norm(b-A*xd,Inf)
6.96332e-13

julia&gt; norm(xd-x,Inf)
2.30371e-12</code></pre><p>Now, if we downcast things to half precision, nothing good happens.</p><pre><code class="nohighlight hljs">julia&gt; AH=Float16.(A);

julia&gt; AHF=hlu!(AH);

julia&gt; z=AHF\b;

julia&gt; norm(b-A*z,Inf)
6.25650e-01

julia&gt; norm(z-xd,Inf)
2.34975e-01</code></pre><p>So you get very poor, but unsurprising, results. While <strong>MultiPrecisionArrays.jl</strong> supports half precision and I use it all the time, it is not something you would use in your own work without looking at the literature and making certain you are prepared for strange results. Getting good results consistently from half precision is an active research area.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Interprecision_1/">« Interprecision Transfers: Part I</a><a class="docs-footer-nextpage" href="../../functions/MPArray/">MPArray: constructor »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.0.0 on <span class="colophon-date" title="Saturday 16 September 2023 21:02">Saturday 16 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
